<app-api-error [errorMessage]="apiError"></app-api-error>
<h2>Registros de Pessoas Possivelmente Duplicadas</h2>
<button mat-raised-button color="primary" (click)="updateDuplicates()" style="margin-bottom: 16px;">
    <mat-icon>refresh</mat-icon> Atualizar Duplicados
</button>
<div *ngIf="loading" style="text-align:center; margin:32px 0;">
    <mat-spinner></mat-spinner>
</div>
<div *ngIf="successMessage" style="margin-bottom: 16px; color: #388e3c; font-weight: bold;">
    {{ successMessage }}
</div>
<table mat-table [dataSource]="data" class="mat-elevation-z8" *ngIf="!loading && data.length > 0">
    <ng-container matColumnDef="person">
        <th mat-header-cell *matHeaderCellDef>Pessoa</th>
        <td mat-cell *matCellDef="let item">
            {{ item.person.name }} (ID: {{ item.person.id }})
        </td>
    </ng-container>
    <ng-container matColumnDef="duplicates">
        <th mat-header-cell *matHeaderCellDef>Duplicados</th>
        <td mat-cell *matCellDef="let item">
            <div *ngFor="let dup of item.duplicate_persons">
                {{ dup.name }} (ID: {{ dup.id }})
            </div>
        </td>
    </ng-container>
    <ng-container matColumnDef="updated_at">
        <th mat-header-cell *matHeaderCellDef>Atualizado em</th>
        <td mat-cell *matCellDef="let item">{{ item.updated_at }}</td>
    </ng-container>
    <tr mat-header-row *matHeaderRowDef="['person', 'duplicates', 'updated_at']"></tr>
    <tr mat-row *matRowDef="let row; columns: ['person', 'duplicates', 'updated_at'];"></tr>
</table>
<mat-paginator *ngIf="paginator" [length]="paginator.total" [pageSize]="paginator.per_page" [pageIndex]="page - 1"
    (page)="onPageChange($event)"></mat-paginator>
<div *ngIf="!loading && data.length === 0" style="text-align:center; margin:32px 0;">Nenhum registro encontrado.</div>